(function(){var $,AbstractChosen,Chosen,SelectParser,_ref,__hasProp={}.hasOwnProperty,__extends=function(a,b){for(var c in b){if(__hasProp.call(b,c))a[c]=b[c]}function ctor(){this.constructor=a}ctor.prototype=b.prototype;a.prototype=new ctor();a.__super__=b.prototype;return a};SelectParser=(function(){function SelectParser(){this.options_index=0;this.parsed=[]}SelectParser.prototype.add_node=function(a){if(a.nodeName.toUpperCase()==="OPTGROUP"){return this.add_group(a)}else{return this.add_option(a)}};SelectParser.prototype.add_group=function(a){var b,option,_i,_len,_ref,_results;b=this.parsed.length;this.parsed.push({array_index:b,group:true,label:this.escapeExpression(a.label),title:a.title?a.title:void 0,children:0,disabled:a.disabled,classes:a.className});_ref=a.childNodes;_results=[];for(_i=0,_len=_ref.length;_i<_len;_i++){option=_ref[_i];_results.push(this.add_option(option,b,a.disabled))}return _results};SelectParser.prototype.add_option=function(a,b,c){if(a.nodeName.toUpperCase()==="OPTION"){if(a.text!==""){if(b!=null){this.parsed[b].children+=1}this.parsed.push({array_index:this.parsed.length,options_index:this.options_index,value:a.value,text:a.text,html:a.innerHTML,title:a.title?a.title:void 0,selected:a.selected,disabled:c===true?c:a.disabled,group_array_index:b,group_label:b!=null?this.parsed[b].label:null,classes:a.className,style:a.style.cssText})}else{this.parsed.push({array_index:this.parsed.length,options_index:this.options_index,empty:true})}return this.options_index+=1}};SelectParser.prototype.escapeExpression=function(b){var c,unsafe_chars;if((b==null)||b===false){return""}if(!/[\&\<\>\"\'\`]/.test(b)){return b}c={"<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"};unsafe_chars=/&(?!\w+;)|[\<\>\"\'\`]/g;return b.replace(unsafe_chars,function(a){return c[a]||"&amp;"})};return SelectParser})();SelectParser.select_to_array=function(a){var b,parser,_i,_len,_ref;parser=new SelectParser();_ref=a.childNodes;for(_i=0,_len=_ref.length;_i<_len;_i++){b=_ref[_i];parser.add_node(b)}return parser.parsed};AbstractChosen=(function(){function AbstractChosen(a,b){this.form_field=a;this.options=b!=null?b:{};if(!AbstractChosen.browser_is_supported()){return}this.is_multiple=this.form_field.multiple;this.set_default_text();this.set_default_values();this.setup();this.set_up_html();this.register_observers();this.on_ready()}AbstractChosen.prototype.set_default_values=function(){var b=this;this.click_test_action=function(a){return b.test_active_click(a)};this.activate_action=function(a){return b.activate_field(a)};this.active_field=false;this.mouse_on_container=false;this.results_showing=false;this.result_highlighted=null;this.allow_single_deselect=(this.options.allow_single_deselect!=null)&&(this.form_field.options[0]!=null)&&this.form_field.options[0].text===""?this.options.allow_single_deselect:false;this.disable_search_threshold=this.options.disable_search_threshold||0;this.disable_search=this.options.disable_search||false;this.enable_split_word_search=this.options.enable_split_word_search!=null?this.options.enable_split_word_search:true;this.group_search=this.options.group_search!=null?this.options.group_search:true;this.search_contains=this.options.search_contains||false;this.single_backstroke_delete=this.options.single_backstroke_delete!=null?this.options.single_backstroke_delete:true;this.max_selected_options=this.options.max_selected_options||Infinity;this.inherit_select_classes=this.options.inherit_select_classes||false;this.display_selected_options=this.options.display_selected_options!=null?this.options.display_selected_options:true;this.display_disabled_options=this.options.display_disabled_options!=null?this.options.display_disabled_options:true;return this.include_group_label_in_selected=this.options.include_group_label_in_selected||false};AbstractChosen.prototype.set_default_text=function(){if(this.form_field.getAttribute("data-placeholder")){this.default_text=this.form_field.getAttribute("data-placeholder")}else if(this.is_multiple){this.default_text=this.options.placeholder_text_multiple||this.options.placeholder_text||AbstractChosen.default_multiple_text}else{this.default_text=this.options.placeholder_text_single||this.options.placeholder_text||AbstractChosen.default_single_text}return this.results_none_found=this.form_field.getAttribute("data-no_results_text")||this.options.no_results_text||AbstractChosen.default_no_result_text};AbstractChosen.prototype.choice_label=function(a){if(this.include_group_label_in_selected&&(a.group_label!=null)){return"<b class='group-name'>"+a.group_label+"</b>"+a.html}else{return a.html}};AbstractChosen.prototype.mouse_enter=function(){return this.mouse_on_container=true};AbstractChosen.prototype.mouse_leave=function(){return this.mouse_on_container=false};AbstractChosen.prototype.input_focus=function(a){var b=this;if(this.is_multiple){if(!this.active_field){return setTimeout((function(){return b.container_mousedown()}),50)}}else{if(!this.active_field){return this.activate_field()}}};AbstractChosen.prototype.input_blur=function(a){var b=this;if(!this.mouse_on_container){this.active_field=false;return setTimeout((function(){return b.blur_test()}),100)}};AbstractChosen.prototype.results_option_build=function(a){var b,data,_i,_len,_ref;b='';_ref=this.results_data;for(_i=0,_len=_ref.length;_i<_len;_i++){data=_ref[_i];if(data.group){b+=this.result_add_group(data)}else{b+=this.result_add_option(data)}if(a!=null?a.first:void 0){if(data.selected&&this.is_multiple){this.choice_build(data)}else if(data.selected&&!this.is_multiple){this.single_set_selected_text(this.choice_label(data))}}}return b};AbstractChosen.prototype.result_add_option=function(a){var b,option_el;if(!a.search_match){return''}if(!this.include_option_in_results(a)){return''}b=[];if(!a.disabled&&!(a.selected&&this.is_multiple)){b.push("active-result")}if(a.disabled&&!(a.selected&&this.is_multiple)){b.push("disabled-result")}if(a.selected){b.push("result-selected")}if(a.group_array_index!=null){b.push("group-option")}if(a.classes!==""){b.push(a.classes)}option_el=document.createElement("li");option_el.className=b.join(" ");option_el.style.cssText=a.style;option_el.setAttribute("data-option-array-index",a.array_index);option_el.innerHTML=a.search_text;if(a.title){option_el.title=a.title}return this.outerHTML(option_el)};AbstractChosen.prototype.result_add_group=function(a){var b,group_el;if(!(a.search_match||a.group_match)){return''}if(!(a.active_options>0)){return''}b=[];b.push("group-result");if(a.classes){b.push(a.classes)}group_el=document.createElement("li");group_el.className=b.join(" ");group_el.innerHTML=a.search_text;if(a.title){group_el.title=a.title}return this.outerHTML(group_el)};AbstractChosen.prototype.results_update_field=function(){this.set_default_text();if(!this.is_multiple){this.results_reset_cleanup()}this.result_clear_highlight();this.results_build();if(this.results_showing){return this.winnow_results()}};AbstractChosen.prototype.reset_single_select_options=function(){var a,_i,_len,_ref,_results;_ref=this.results_data;_results=[];for(_i=0,_len=_ref.length;_i<_len;_i++){a=_ref[_i];if(a.selected){_results.push(a.selected=false)}else{_results.push(void 0)}}return _results};AbstractChosen.prototype.results_toggle=function(){if(this.results_showing){return this.results_hide()}else{return this.results_show()}};AbstractChosen.prototype.results_search=function(a){if(this.results_showing){return this.winnow_results()}else{return this.results_show()}};AbstractChosen.prototype.winnow_results=function(){var a,option,regex,results,results_group,searchText,startpos,text,zregex,_i,_len,_ref;this.no_results_clear();results=0;searchText=this.get_search_text();a=searchText.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&");zregex=new RegExp(a,'i');regex=this.get_search_regex(a);_ref=this.results_data;for(_i=0,_len=_ref.length;_i<_len;_i++){option=_ref[_i];option.search_match=false;results_group=null;if(this.include_option_in_results(option)){if(option.group){option.group_match=false;option.active_options=0}if((option.group_array_index!=null)&&this.results_data[option.group_array_index]){results_group=this.results_data[option.group_array_index];if(results_group.active_options===0&&results_group.search_match){results+=1}results_group.active_options+=1}option.search_text=option.group?option.label:option.html;if(!(option.group&&!this.group_search)){option.search_match=this.search_string_match(option.search_text,regex);if(option.search_match&&!option.group){results+=1}if(option.search_match){if(searchText.length){startpos=option.search_text.search(zregex);text=option.search_text.substr(0,startpos+searchText.length)+'</em>'+option.search_text.substr(startpos+searchText.length);option.search_text=text.substr(0,startpos)+'<em>'+text.substr(startpos)}if(results_group!=null){results_group.group_match=true}}else if((option.group_array_index!=null)&&this.results_data[option.group_array_index].search_match){option.search_match=true}}}}this.result_clear_highlight();if(results<1&&searchText.length){this.update_results_content("");return this.no_results(searchText)}else{this.update_results_content(this.results_option_build());return this.winnow_results_set_highlight()}};AbstractChosen.prototype.get_search_regex=function(a){var b;b=this.search_contains?"":"^";return new RegExp(b+a,'i')};AbstractChosen.prototype.search_string_match=function(a,b){var c,parts,_i,_len;if(b.test(a)){return true}else if(this.enable_split_word_search&&(a.indexOf(" ")>=0||a.indexOf("[")===0)){parts=a.replace(/\[|\]/g,"").split(" ");if(parts.length){for(_i=0,_len=parts.length;_i<_len;_i++){c=parts[_i];if(b.test(c)){return true}}}}};AbstractChosen.prototype.choices_count=function(){var a,_i,_len,_ref;if(this.selected_option_count!=null){return this.selected_option_count}this.selected_option_count=0;_ref=this.form_field.options;for(_i=0,_len=_ref.length;_i<_len;_i++){a=_ref[_i];if(a.selected){this.selected_option_count+=1}}return this.selected_option_count};AbstractChosen.prototype.choices_click=function(a){a.preventDefault();if(!(this.results_showing||this.is_disabled)){return this.results_show()}};AbstractChosen.prototype.keyup_checker=function(a){var b,_ref;b=(_ref=a.which)!=null?_ref:a.keyCode;this.search_field_scale();switch(b){case 8:if(this.is_multiple&&this.backstroke_length<1&&this.choices_count()>0){return this.keydown_backstroke()}else if(!this.pending_backstroke){this.result_clear_highlight();return this.results_search()}break;case 13:a.preventDefault();if(this.results_showing){return this.result_select(a)}break;case 27:if(this.results_showing){this.results_hide()}return true;case 9:case 38:case 40:case 16:case 91:case 17:break;default:return this.results_search()}};AbstractChosen.prototype.clipboard_event_checker=function(a){var b=this;return setTimeout((function(){return b.results_search()}),50)};AbstractChosen.prototype.container_width=function(){if(this.options.width!=null){return this.options.width}else{return""+this.form_field.offsetWidth+"px"}};AbstractChosen.prototype.include_option_in_results=function(a){if(this.is_multiple&&(!this.display_selected_options&&a.selected)){return false}if(!this.display_disabled_options&&a.disabled){return false}if(a.empty){return false}return true};AbstractChosen.prototype.search_results_touchstart=function(a){this.touch_started=true;return this.search_results_mouseover(a)};AbstractChosen.prototype.search_results_touchmove=function(a){this.touch_started=false;return this.search_results_mouseout(a)};AbstractChosen.prototype.search_results_touchend=function(a){if(this.touch_started){return this.search_results_mouseup(a)}};AbstractChosen.prototype.outerHTML=function(a){var b;if(a.outerHTML){return a.outerHTML}b=document.createElement("div");b.appendChild(a);return b.innerHTML};AbstractChosen.browser_is_supported=function(){if(window.navigator.appName==="Microsoft Internet Explorer"){return document.documentMode>=8}if(/iP(od|hone)/i.test(window.navigator.userAgent)){return false}if(/Android/i.test(window.navigator.userAgent)){if(/Mobile/i.test(window.navigator.userAgent)){return false}}return true};AbstractChosen.default_multiple_text="Select Some Options";AbstractChosen.default_single_text="Select an Option";AbstractChosen.default_no_result_text="No results match";return AbstractChosen})();$=jQuery;$.fn.extend({chosen:function(c){if(!AbstractChosen.browser_is_supported()){return this}return this.each(function(a){var b,chosen;b=$(this);chosen=b.data('chosen');if(c==='destroy'&&chosen instanceof Chosen){chosen.destroy()}else if(!(chosen instanceof Chosen)){b.data('chosen',new Chosen(this,c))}})}});Chosen=(function(d){__extends(Chosen,d);function Chosen(){_ref=Chosen.__super__.constructor.apply(this,arguments);return _ref}Chosen.prototype.setup=function(){this.form_field_jq=$(this.form_field);this.current_selectedIndex=this.form_field.selectedIndex;return this.is_rtl=this.form_field_jq.hasClass("chosen-rtl")};Chosen.prototype.set_up_html=function(){var a,container_props;a=["chosen-container"];a.push("chosen-container-"+(this.is_multiple?"multi":"single"));if(this.inherit_select_classes&&this.form_field.className){a.push(this.form_field.className)}if(this.is_rtl){a.push("chosen-rtl")}container_props={'class':a.join(' '),'style':"width: "+(this.container_width())+";",'title':this.form_field.title};if(this.form_field.id.length){container_props.id=this.form_field.id.replace(/[^\w]/g,'_')+"_chosen"}this.container=$("<div />",container_props);if(this.is_multiple){this.container.html('<ul class="chosen-choices"><li class="search-field"><input type="text" value="'+this.default_text+'" class="default" autocomplete="off" style="width:25px;" /></li></ul><div class="chosen-drop"><ul class="chosen-results"></ul></div>')}else{this.container.html('<a class="chosen-single chosen-default" tabindex="-1"><span>'+this.default_text+'</span><div><b></b></div></a><div class="chosen-drop"><div class="chosen-search"><input type="text" autocomplete="off" /></div><ul class="chosen-results"></ul></div>')}this.form_field_jq.hide().after(this.container);this.dropdown=this.container.find('div.chosen-drop').first();this.search_field=this.container.find('input').first();this.search_results=this.container.find('ul.chosen-results').first();this.search_field_scale();this.search_no_results=this.container.find('li.no-results').first();if(this.is_multiple){this.search_choices=this.container.find('ul.chosen-choices').first();this.search_container=this.container.find('li.search-field').first()}else{this.search_container=this.container.find('div.chosen-search').first();this.selected_item=this.container.find('.chosen-single').first()}this.results_build();this.set_tab_index();return this.set_label_behavior()};Chosen.prototype.on_ready=function(){return this.form_field_jq.trigger("chosen:ready",{chosen:this})};Chosen.prototype.register_observers=function(){var b=this;this.container.bind('touchstart.chosen',function(a){b.container_mousedown(a);return a.preventDefault()});this.container.bind('touchend.chosen',function(a){b.container_mouseup(a);return a.preventDefault()});this.container.bind('mousedown.chosen',function(a){b.container_mousedown(a)});this.container.bind('mouseup.chosen',function(a){b.container_mouseup(a)});this.container.bind('mouseenter.chosen',function(a){b.mouse_enter(a)});this.container.bind('mouseleave.chosen',function(a){b.mouse_leave(a)});this.search_results.bind('mouseup.chosen',function(a){b.search_results_mouseup(a)});this.search_results.bind('mouseover.chosen',function(a){b.search_results_mouseover(a)});this.search_results.bind('mouseout.chosen',function(a){b.search_results_mouseout(a)});this.search_results.bind('mousewheel.chosen DOMMouseScroll.chosen',function(a){b.search_results_mousewheel(a)});this.search_results.bind('touchstart.chosen',function(a){b.search_results_touchstart(a)});this.search_results.bind('touchmove.chosen',function(a){b.search_results_touchmove(a)});this.search_results.bind('touchend.chosen',function(a){b.search_results_touchend(a)});this.form_field_jq.bind("chosen:updated.chosen",function(a){b.results_update_field(a)});this.form_field_jq.bind("chosen:activate.chosen",function(a){b.activate_field(a)});this.form_field_jq.bind("chosen:open.chosen",function(a){b.container_mousedown(a)});this.form_field_jq.bind("chosen:close.chosen",function(a){b.input_blur(a)});this.search_field.bind('blur.chosen',function(a){b.input_blur(a)});this.search_field.bind('keyup.chosen',function(a){b.keyup_checker(a)});this.search_field.bind('keydown.chosen',function(a){b.keydown_checker(a)});this.search_field.bind('focus.chosen',function(a){b.input_focus(a)});this.search_field.bind('cut.chosen',function(a){b.clipboard_event_checker(a)});this.search_field.bind('paste.chosen',function(a){b.clipboard_event_checker(a)});if(this.is_multiple){return this.search_choices.bind('click.chosen',function(a){b.choices_click(a)})}else{return this.container.bind('click.chosen',function(a){a.preventDefault()})}};Chosen.prototype.destroy=function(){$(this.container[0].ownerDocument).unbind("click.chosen",this.click_test_action);if(this.search_field[0].tabIndex){this.form_field_jq[0].tabIndex=this.search_field[0].tabIndex}this.container.remove();this.form_field_jq.removeData('chosen');return this.form_field_jq.show()};Chosen.prototype.search_field_disabled=function(){this.is_disabled=this.form_field_jq[0].disabled;if(this.is_disabled){this.container.addClass('chosen-disabled');this.search_field[0].disabled=true;if(!this.is_multiple){this.selected_item.unbind("focus.chosen",this.activate_action)}return this.close_field()}else{this.container.removeClass('chosen-disabled');this.search_field[0].disabled=false;if(!this.is_multiple){return this.selected_item.bind("focus.chosen",this.activate_action)}}};Chosen.prototype.container_mousedown=function(a){if(!this.is_disabled){if(a&&a.type==="mousedown"&&!this.results_showing){a.preventDefault()}if(!((a!=null)&&($(a.target)).hasClass("search-choice-close"))){if(!this.active_field){if(this.is_multiple){this.search_field.val("")}$(this.container[0].ownerDocument).bind('click.chosen',this.click_test_action);this.results_show()}else if(!this.is_multiple&&a&&(($(a.target)[0]===this.selected_item[0])||$(a.target).parents("a.chosen-single").length)){a.preventDefault();this.results_toggle()}return this.activate_field()}}};Chosen.prototype.container_mouseup=function(a){if(a.target.nodeName==="ABBR"&&!this.is_disabled){return this.results_reset(a)}};Chosen.prototype.search_results_mousewheel=function(a){var b;if(a.originalEvent){b=a.originalEvent.deltaY||-a.originalEvent.wheelDelta||a.originalEvent.detail}if(b!=null){a.preventDefault();if(a.type==='DOMMouseScroll'){b=b*40}return this.search_results.scrollTop(b+this.search_results.scrollTop())}};Chosen.prototype.blur_test=function(a){if(!this.active_field&&this.container.hasClass("chosen-container-active")){return this.close_field()}};Chosen.prototype.close_field=function(){$(this.container[0].ownerDocument).unbind("click.chosen",this.click_test_action);this.active_field=false;this.results_hide();this.container.removeClass("chosen-container-active");this.clear_backstroke();this.show_search_field_default();return this.search_field_scale()};Chosen.prototype.activate_field=function(){this.container.addClass("chosen-container-active");this.active_field=true;this.search_field.val(this.search_field.val());return this.search_field.focus()};Chosen.prototype.test_active_click=function(a){var b;b=$(a.target).closest('.chosen-container');if(b.length&&this.container[0]===b[0]){return this.active_field=true}else{return this.close_field()}};Chosen.prototype.results_build=function(){this.parsing=true;this.selected_option_count=null;this.results_data=SelectParser.select_to_array(this.form_field);if(this.is_multiple){this.search_choices.find("li.search-choice").remove()}else if(!this.is_multiple){this.single_set_selected_text();if(this.disable_search||this.form_field.options.length<=this.disable_search_threshold){this.search_field[0].readOnly=true;this.container.addClass("chosen-container-single-nosearch")}else{this.search_field[0].readOnly=false;this.container.removeClass("chosen-container-single-nosearch")}}this.update_results_content(this.results_option_build({first:true}));this.search_field_disabled();this.show_search_field_default();this.search_field_scale();return this.parsing=false};Chosen.prototype.result_do_highlight=function(a){var b,high_top,maxHeight,visible_bottom,visible_top;if(a.length){this.result_clear_highlight();this.result_highlight=a;this.result_highlight.addClass("highlighted");maxHeight=parseInt(this.search_results.css("maxHeight"),10);visible_top=this.search_results.scrollTop();visible_bottom=maxHeight+visible_top;high_top=this.result_highlight.position().top+this.search_results.scrollTop();b=high_top+this.result_highlight.outerHeight();if(b>=visible_bottom){return this.search_results.scrollTop((b-maxHeight)>0?b-maxHeight:0)}else if(high_top<visible_top){return this.search_results.scrollTop(high_top)}}};Chosen.prototype.result_clear_highlight=function(){if(this.result_highlight){this.result_highlight.removeClass("highlighted")}return this.result_highlight=null};Chosen.prototype.results_show=function(){if(this.is_multiple&&this.max_selected_options<=this.choices_count()){this.form_field_jq.trigger("chosen:maxselected",{chosen:this});return false}this.container.addClass("chosen-with-drop");this.results_showing=true;this.search_field.focus();this.search_field.val(this.search_field.val());this.winnow_results();return this.form_field_jq.trigger("chosen:showing_dropdown",{chosen:this})};Chosen.prototype.update_results_content=function(a){return this.search_results.html(a)};Chosen.prototype.results_hide=function(){if(this.results_showing){this.result_clear_highlight();this.container.removeClass("chosen-with-drop");this.form_field_jq.trigger("chosen:hiding_dropdown",{chosen:this})}return this.results_showing=false};Chosen.prototype.set_tab_index=function(a){var b;if(this.form_field.tabIndex){b=this.form_field.tabIndex;this.form_field.tabIndex=-1;return this.search_field[0].tabIndex=b}};Chosen.prototype.set_label_behavior=function(){var b=this;this.form_field_label=this.form_field_jq.parents("label");if(!this.form_field_label.length&&this.form_field.id.length){this.form_field_label=$("label[for='"+this.form_field.id+"']")}if(this.form_field_label.length>0){return this.form_field_label.bind('click.chosen',function(a){if(b.is_multiple){return b.container_mousedown(a)}else{return b.activate_field()}})}};Chosen.prototype.show_search_field_default=function(){if(this.is_multiple&&this.choices_count()<1&&!this.active_field){this.search_field.val(this.default_text);return this.search_field.addClass("default")}else{this.search_field.val("");return this.search_field.removeClass("default")}};Chosen.prototype.search_results_mouseup=function(a){var b;b=$(a.target).hasClass("active-result")?$(a.target):$(a.target).parents(".active-result").first();if(b.length){this.result_highlight=b;this.result_select(a);return this.search_field.focus()}};Chosen.prototype.search_results_mouseover=function(a){var b;b=$(a.target).hasClass("active-result")?$(a.target):$(a.target).parents(".active-result").first();if(b){return this.result_do_highlight(b)}};Chosen.prototype.search_results_mouseout=function(a){if($(a.target).hasClass("active-result"||$(a.target).parents('.active-result').first())){return this.result_clear_highlight()}};Chosen.prototype.choice_build=function(b){var c,close_link,_this=this;c=$('<li />',{"class":"search-choice"}).html("<span>"+(this.choice_label(b))+"</span>");if(b.disabled){c.addClass('search-choice-disabled')}else{close_link=$('<a />',{"class":'search-choice-close','data-option-array-index':b.array_index});close_link.bind('click.chosen',function(a){return _this.choice_destroy_link_click(a)});c.append(close_link)}return this.search_container.before(c)};Chosen.prototype.choice_destroy_link_click=function(a){a.preventDefault();a.stopPropagation();if(!this.is_disabled){return this.choice_destroy($(a.target))}};Chosen.prototype.choice_destroy=function(a){if(this.result_deselect(a[0].getAttribute("data-option-array-index"))){this.show_search_field_default();if(this.is_multiple&&this.choices_count()>0&&this.search_field.val().length<1){this.results_hide()}a.parents('li').first().remove();return this.search_field_scale()}};Chosen.prototype.results_reset=function(){this.reset_single_select_options();this.form_field.options[0].selected=true;this.single_set_selected_text();this.show_search_field_default();this.results_reset_cleanup();this.form_field_jq.trigger("change");if(this.active_field){return this.results_hide()}};Chosen.prototype.results_reset_cleanup=function(){this.current_selectedIndex=this.form_field.selectedIndex;return this.selected_item.find("abbr").remove()};Chosen.prototype.result_select=function(a){var b,item;if(this.result_highlight){b=this.result_highlight;this.result_clear_highlight();if(this.is_multiple&&this.max_selected_options<=this.choices_count()){this.form_field_jq.trigger("chosen:maxselected",{chosen:this});return false}if(this.is_multiple){b.removeClass("active-result")}else{this.reset_single_select_options()}b.addClass("result-selected");item=this.results_data[b[0].getAttribute("data-option-array-index")];item.selected=true;this.form_field.options[item.options_index].selected=true;this.selected_option_count=null;if(this.is_multiple){this.choice_build(item)}else{this.single_set_selected_text(this.choice_label(item))}if(!((a.metaKey||a.ctrlKey)&&this.is_multiple)){this.results_hide()}this.search_field.val("");if(this.is_multiple||this.form_field.selectedIndex!==this.current_selectedIndex){this.form_field_jq.trigger("change",{'selected':this.form_field.options[item.options_index].value})}this.current_selectedIndex=this.form_field.selectedIndex;a.preventDefault();return this.search_field_scale()}};Chosen.prototype.single_set_selected_text=function(a){if(a==null){a=this.default_text}if(a===this.default_text){this.selected_item.addClass("chosen-default")}else{this.single_deselect_control_build();this.selected_item.removeClass("chosen-default")}return this.selected_item.find("span").html(a)};Chosen.prototype.result_deselect=function(a){var b;b=this.results_data[a];if(!this.form_field.options[b.options_index].disabled){b.selected=false;this.form_field.options[b.options_index].selected=false;this.selected_option_count=null;this.result_clear_highlight();if(this.results_showing){this.winnow_results()}this.form_field_jq.trigger("change",{deselected:this.form_field.options[b.options_index].value});this.search_field_scale();return true}else{return false}};Chosen.prototype.single_deselect_control_build=function(){if(!this.allow_single_deselect){return}if(!this.selected_item.find("abbr").length){this.selected_item.find("span").first().after("<abbr class=\"search-choice-close\"></abbr>")}return this.selected_item.addClass("chosen-single-with-deselect")};Chosen.prototype.get_search_text=function(){return $('<div/>').text($.trim(this.search_field.val())).html()};Chosen.prototype.winnow_results_set_highlight=function(){var a,selected_results;selected_results=!this.is_multiple?this.search_results.find(".result-selected.active-result"):[];a=selected_results.length?selected_results.first():this.search_results.find(".active-result").first();if(a!=null){return this.result_do_highlight(a)}};Chosen.prototype.no_results=function(a){var b;b=$('<li class="no-results">'+this.results_none_found+' "<span></span>"</li>');b.find("span").first().html(a);this.search_results.append(b);return this.form_field_jq.trigger("chosen:no_results",{chosen:this})};Chosen.prototype.no_results_clear=function(){return this.search_results.find(".no-results").remove()};Chosen.prototype.keydown_arrow=function(){var a;if(this.results_showing&&this.result_highlight){a=this.result_highlight.nextAll("li.active-result").first();if(a){return this.result_do_highlight(a)}}else{return this.results_show()}};Chosen.prototype.keyup_arrow=function(){var a;if(!this.results_showing&&!this.is_multiple){return this.results_show()}else if(this.result_highlight){a=this.result_highlight.prevAll("li.active-result");if(a.length){return this.result_do_highlight(a.first())}else{if(this.choices_count()>0){this.results_hide()}return this.result_clear_highlight()}}};Chosen.prototype.keydown_backstroke=function(){var a;if(this.pending_backstroke){this.choice_destroy(this.pending_backstroke.find("a").first());return this.clear_backstroke()}else{a=this.search_container.siblings("li.search-choice").last();if(a.length&&!a.hasClass("search-choice-disabled")){this.pending_backstroke=a;if(this.single_backstroke_delete){return this.keydown_backstroke()}else{return this.pending_backstroke.addClass("search-choice-focus")}}}};Chosen.prototype.clear_backstroke=function(){if(this.pending_backstroke){this.pending_backstroke.removeClass("search-choice-focus")}return this.pending_backstroke=null};Chosen.prototype.keydown_checker=function(a){var b,_ref1;b=(_ref1=a.which)!=null?_ref1:a.keyCode;this.search_field_scale();if(b!==8&&this.pending_backstroke){this.clear_backstroke()}switch(b){case 8:this.backstroke_length=this.search_field.val().length;break;case 9:if(this.results_showing&&!this.is_multiple){this.result_select(a)}this.mouse_on_container=false;break;case 13:if(this.results_showing){a.preventDefault()}break;case 32:if(this.disable_search){a.preventDefault()}break;case 38:a.preventDefault();this.keyup_arrow();break;case 40:a.preventDefault();this.keydown_arrow();break}};Chosen.prototype.search_field_scale=function(){var a,f_width,h,style,style_block,styles,w,_i,_len;if(this.is_multiple){h=0;w=0;style_block="position:absolute; left: -1000px; top: -1000px; display:none;";styles=['font-size','font-style','font-weight','font-family','line-height','text-transform','letter-spacing'];for(_i=0,_len=styles.length;_i<_len;_i++){style=styles[_i];style_block+=style+":"+this.search_field.css(style)+";"}a=$('<div />',{'style':style_block});a.text(this.search_field.val());$('body').append(a);w=a.width()+25;a.remove();f_width=this.container.outerWidth();if(w>f_width-10){w=f_width-10}return this.search_field.css({'width':w+'px'})}};return Chosen})(AbstractChosen)}).call(this);(function($){function FT(a){this.$textarea=$(a);this._init()}FT.prototype={_init:function(){var b=this;this.$textarea.wrap('<div class="flex-text-wrap" />').before('<pre><span /><br /><br /></pre>');this.$span=this.$textarea.prev().find('span');this.$textarea.on('input propertychange keyup change',function(){b._mirror()});$.valHooks.textarea={get:function(a){return a.value.replace(/\r?\n/g,"\r\n")}};this._mirror()},_mirror:function(){this.$span.text(this.$textarea.val())}};$.fn.flexText=function(){return this.each(function(){if(!$.data(this,'flexText')){$.data(this,'flexText',new FT(this))}})}})(jQuery);jQuery(document).ready(function(){wpeo_task.init();jQuery.fn.bgLoad=function(a){return this.each(function(){if(a==undefined)jQuery(this).append('<div class="mask-loader"><div class="sk-circle"><div class="sk-circle1 sk-child"></div><div class="sk-circle2 sk-child"></div><div class="sk-circle3 sk-child"></div><div class="sk-circle4 sk-child"></div><div class="sk-circle5 sk-child"></div><div class="sk-circle6 sk-child"></div><div class="sk-circle7 sk-child"></div><div class="sk-circle8 sk-child"></div><div class="sk-circle9 sk-child"></div><div class="sk-circle10 sk-child"></div><div class="sk-circle11 sk-child"></div><div class="sk-circle12 sk-child"></div></div></div>');else{jQuery(this).find('.mask-loader').remove()}})}});var wpeo_task={grid:undefined,filter_class_task:[],array_marker:[],all_task:true,my_task:false,assigned_task:false,init:function(){this.event()},masonry:function(){wpeo_task.grid=jQuery('.wpeo-project-list-task').masonry({itemSelector:'.wpeo-project-task',columnWidth:'.wpeo-project-task-size',})},event:function(){jQuery('.wpeo-project-wrap').on('click','.wpeo-project-new-task',function(a){wpeo_task.create(a,jQuery(this))});jQuery('.wpeo-project-wrap').on('click','.wpeo-project-task-title',function(){wpeo_task.open_window(jQuery(this))});jQuery('.wpeo-project-wrap').on('click','.wpeo-task-open-dashboard',function(){wpeo_task.open_window(jQuery(this))});jQuery('.wpeo-project-wrap').on('blur','.wpeo-project-task-title',function(){wpeo_task.edit(jQuery(this))});jQuery('.wpeo-project-wrap').on('keydown','.wpeo-project-task-title',function(e){if(e.which==13){jQuery(this).blur()}});jQuery('.wpeo-project-wrap').on('keyup','.wpeo-project-task-title',function(e){wpeo_task.preview(jQuery(this))});jQuery('.wpeo-project-wrap').on('click','.wpeo-send-task-to-trash',function(e){wpeo_task.delete(jQuery(this))});jQuery('.wpeo-project-wrap').on('click','#wpeo-user-affected-to-the-task',function(){wpeo_task.edit_setting(jQuery(this))});jQuery('.wpeo-project-wrap').on('click','#wpeo-time-attected-to-the-task',function(){wpeo_task.edit_setting(jQuery(this))});jQuery('.wpeo-project-wrap').on('blur','.wpeo-project-task-time-estimated',function(){wpeo_task.edit(jQuery(this))});jQuery(document).on('click','.task-marker',function(){wpeo_task.add_marker(jQuery(this))});jQuery(document).on('click','.wpeo-send-task-to-archive',function(){wpeo_task.to_archive(jQuery(this))});jQuery(document).on('click','.wpeo-project-task-archive',function(){wpeo_task.view_archive(jQuery(this))});jQuery(document).on('click','.wpeo-export',function(){wpeo_task.export(jQuery(this))});jQuery(document).on('click','.wpeo-export-comment',function(){wpeo_task.export_comment(jQuery(this))});jQuery(document).on('click','.wpeo-project-export-all',function(a){wpeo_task.export_all(a,jQuery(this))});jQuery(document).on('click','.wpeo-button-all-task',function(){wpeo_task.display_all_task(jQuery(this))});jQuery(document).on('click','.wpeo-button-my-task',function(){wpeo_task.display_my_task(jQuery(this))});jQuery(document).on('click','.wpeo-button-assigned-task',function(){wpeo_task.display_assigned_task(jQuery(this))});jQuery(document).on('click','#wpeo-window-dashboard i',function(){wpeo_task.display_task()});jQuery('.wpeo-project-wrap .wpshop-customer-filter').chosen().change(function(a,b){wpeo_task.change_customer_filter(a,b)});jQuery(document).on('click','.wpeo-project-compile-time',function(a){wpeo_task.recompile_time(a,jQuery(this))});jQuery(document).on('click','.wpeo-project-last-comment .wpeo-last-point',function(a){wpeo_task.go_to(a,jQuery(this))})},create:function(b,c){b.preventDefault();jQuery('.wpeo-project-list-task').bgLoad();var d=jQuery(c).attr('href').replace('admin-post.php','admin-ajax.php');var e={parent_id:jQuery('.wpeo-task-post-parent').val(),};jQuery.eoajax(d,e,function(){var a=jQuery(this.template);wpeo_task.grid.prepend(a).masonry('prepended',a);jQuery('.wpeo-project-message-no-task').remove();jQuery('#wpeo-window-dashboard').hide();jQuery('.wpeo-point-textarea.active').removeClass('active');jQuery('.wpeo-project-list-task').bgLoad('stop')})},open_window:function(b){jQuery('#wpeo-window-dashboard *').css('opacity',0);var c=jQuery(b).closest('.wpeo-project-task').data('id');jQuery('.wpeo-project-task:not(.wpeo-project-task-'+c+')').hide();wpeo_task.grid.masonry();jQuery('#wpeo-window-dashboard').css({'display':'flex','left':'-80px','opacity':0.10}).bgLoad();jQuery('#wpeo-window-dashboard').animate({'opacity':1,'left':0,},200);var d={action:'load_dashboard_task',task_id:c,_wpnonce:jQuery(b).data('nonce'),};jQuery.eoajax(ajaxurl,d,function(){jQuery('#wpeo-window-dashboard').html(this.template);jQuery('#wpeo-window-dashboard *:not(.wpeo-window-background-avatar)').css('opacity',0).animate({opacity:1,},400);jQuery('#wpeo-window-dashboard').bgLoad('stop');var a=parseInt(jQuery('#wpeo-window-dashboard').height()+200);jQuery('#wpeo-tasks-metabox').css('height',a)})},edit:function(a){var b=jQuery(a).closest('.wpeo-project-task');var c=b.data('id');var d=jQuery(a).closest('form');var e={action:'edit_task',task:{id:c,parent_id:jQuery('.wpeo-task-post-parent').val(),}};jQuery.eoAjaxSubmit(d,e,function(){})},preview:function(a){jQuery('#wpeo-window-dashboard header h2').text(jQuery(a).val())},delete:function(a){if(confirm(wpeo_project_delete)){var b=jQuery(a).closest('#wpeo-task-sub-header').data('id');var c={action:'delete_task',task_id:b,_wpnonce:jQuery(a).data('nonce'),};jQuery('.wpeo-project-task-'+b).remove();wpeo_task.grid.masonry();jQuery('#wpeo-window-dashboard').hide();jQuery.eoajax(ajaxurl,c,function(){jQuery('.wpeo-button-all-task').click()})}},edit_setting:function(a){var b={action:'edit_task',};jQuery.eoAjaxSubmit(jQuery('#wpeo-task-option form'),b,function(){})},to_archive:function(a){var b=jQuery(a).closest('#wpeo-task-sub-header').data('id');var c={action:'archive_task',task_id:b,_wpnonce:jQuery(a).data('nonce'),};jQuery.eoajax(ajaxurl,c,function(){jQuery('.wpeo-project-task-'+b).remove();jQuery('.wpeo-button-all-task').click()})},filter_task:function(){var a=wpeo_task.filter_class_task.join('');var b=false;for(var c in wpeo_task.filter_class_task){if(wpeo_task.filter_class_task[c]=='.wpeo-archive'){b=true;break}}jQuery('.wpeo-project-task').hide();if(a!=''){if(b){jQuery('.wpeo-project-task').each(function(){if(jQuery(this).is(a))jQuery(this).show()})}else{jQuery('.wpeo-project-task:not(.wpeo-archive)').each(function(){if(jQuery(this).is(a))jQuery(this).show()})}}else{jQuery('.wpeo-project-task:not(.wpeo-archive)').show()}jQuery('#wpeo-window-dashboard').hide();jQuery('.wpeo-point-textarea.active').removeClass('active');wpeo_task.grid.masonry()},add_marker:function(a){var b=jQuery(a).closest('.wpeo-project-task');var c=b.data('id');var d=b.find('.wpeo-project-task-container');var e=jQuery(a);if(!b.hasClass('wpeo-task-selected')){b.addClass('wpeo-task-selected');d.css('box-shadow','0 0 0 4px #328DCF');d.css('-webkit-box-shadow','0 0 0 4px #328DCF');d.css('-moz-box-shadow','0 0 0 4px #328DCF');d.css('-o-box-shadow','0 0 0 4px #328DCF');e.css('background','#328DCF');e.css('border','4px solid #fff');this.array_marker.push(c)}else{b.removeClass('wpeo-task-selected');var f=this.array_marker.indexOf(c);if(f>-1){this.array_marker.splice(f,1)}d.css('box-shadow','1px 1px 5px 0px rgba(0,0,0,.2)');d.css('-webkit-box-shadow','1px 1px 5px 0px rgba(0,0,0,.2)');d.css('-moz-box-shadow','1px 1px 5px 0px rgba(0,0,0,.2)');d.css('-o-box-shadow','1px 1px 5px 0px rgba(0,0,0,.2)');e.css('background','#fff');e.css('border','4px solid rgba(0,0,0,0.4)')}if(this.array_marker.length==0){jQuery('.wpeo-project-export-all').addClass('disabled')}else{jQuery('.wpeo-project-export-all').removeClass('disabled')}},export:function(a){var b=jQuery(a).closest(' #wpeo-task-sub-header').data('id');var c={action:'export_task',id:b,_wpnonce:jQuery(a).data('nonce'),};jQuery.eoajax(ajaxurl,c,function(){wpeo_task.download_export(this.url_to_file,false)})},export_comment:function(a){var b=jQuery(a).closest(' #wpeo-task-sub-header').data('id');var c={action:'export_task',id:b,comment:true,_wpnonce:jQuery(a).data('nonce'),};jQuery.eoajax(ajaxurl,c,function(){wpeo_task.download_export(this.url_to_file,false)})},export_all:function(a,b){a.preventDefault();if(!jQuery(b).hasClass('disabled')){var c={action:'export_all_task',_wpnonce:jQuery(b).data('nonce'),array_task_id:this.array_marker};jQuery.eoajax(ajaxurl,c,function(){wpeo_task.download_export(this.url_to_file,true)})}},download_export:function(a,b){var c=jQuery('<a href="'+a+'" download="Export"></a>');jQuery('.wpeo-project-wrap').append(c);c[0].click();c.remove();if(b){jQuery('.wpeo-task-selected').each(function(){jQuery(this).find('.task-marker').click()})}},display_all_task:function(a){jQuery('.wpeo-project-task.wpeo-project-task-customer').remove();wpeo_task.all_task=true;wpeo_task.my_task=false;wpeo_task.assigned_task=false;jQuery('.wpeo-button-active').removeClass('wpeo-button-active');jQuery(a).addClass('wpeo-button-active');jQuery('.wpeo-project-task').hide();jQuery('.wpeo-project-task:not(.wpeo-archive)').show();wpeo_task.filter_task();wpeo_task.grid.masonry();jQuery('#wpeo-window-dashboard').hide();jQuery('.wpeo-point-textarea.active').removeClass('active')},display_my_task:function(a){jQuery('.wpeo-project-task.wpeo-project-task-customer').remove();wpeo_task.all_task=false;wpeo_task.my_task=true;wpeo_task.assigned_task=false;jQuery('.wpeo-button-active').removeClass('wpeo-button-active');jQuery(a).addClass('wpeo-button-active');wpeo_task.filter_task();jQuery('.wpeo-project-task:not(.wpeo-my-task)').hide();wpeo_task.grid.masonry();jQuery('#wpeo-window-dashboard').hide();jQuery('.wpeo-point-textarea.active').removeClass('active')},display_assigned_task:function(a){jQuery('.wpeo-project-task.wpeo-project-task-customer').remove();wpeo_task.all_task=false;wpeo_task.my_task=false;wpeo_task.assigned_task=true;jQuery('.wpeo-button-active').removeClass('wpeo-button-active');jQuery(a).addClass('wpeo-button-active');wpeo_task.filter_task();jQuery('.wpeo-project-task:not(.wpeo-affected-task)').hide();wpeo_task.grid.masonry();jQuery('#wpeo-window-dashboard').hide();jQuery('.wpeo-point-textarea.active').removeClass('active')},clear_filter:function(){wpeo_task.all_task=false;wpeo_task.my_task=false;wpeo_task.assigned_task=false;jQuery('.search-choice-close').click();wpeo_task.filter_class_task.length=0;wpeo_task.filter_task();wpeo_task.grid.masonry()},change_customer_filter:function(b,c){if(c.selected!=undefined){jQuery('.wpeo-button-active').removeClass('wpeo-button-active');jQuery('.wpeo-project-task:not(.wpeo-project-task-customer)').hide();jQuery('#wpeo-window-dashboard').hide();var d={action:'load_task_customer',customer_id:c.selected,_wpnonce:jQuery('.wpshop-customer-filter option[value="'+c.selected+'"]').data('nonce'),};jQuery.eoajax(ajaxurl,d,function(){var a=jQuery(this.template);wpeo_task.grid.prepend(a).masonry('prepended',a)})}if(c.deselected!=undefined){jQuery('.wpeo-project-task-customer-'+c.deselected).remove();if(jQuery('.wpshop-customer-filter option:selected').length<=0){jQuery('.wpeo-project-task-customer').remove();jQuery('.wpeo-project-task').show()}}wpeo_task.grid.masonry()},recompile_time:function(a,b){jQuery(b).bgLoad();var c={action:'compile_time',_wpnonce:jQuery(b).data('nonce'),};jQuery.eoajax(ajaxurl,c,function(){jQuery(b).bgLoad('stop')})},calcul_time:function(){},go_to:function(a,b){var c=jQuery(b).data('user');var d=jQuery(b).data('id');jQuery('.wpshop-customer-filter > option[value="'+c+'"]').prop('selected',true);jQuery('.wpshop-customer-filter').change()},display_task:function(){if(wpeo_task.all_task){jQuery('.wpeo-button-all-task').click()}else if(wpeo_task.my_task){jQuery('.wpeo-button-my-task').click()}else if(wpeo_task.assigned_task){jQuery('.wpeo-button-assigned-task').click()}}};jQuery(document).ready(function(){wpeo_point.init()});var wpeo_point={init:function(){this.refresh_flextext();this.refresh_sortable();if(wpeo_task)wpeo_task.masonry();this.event()},event:function(){jQuery('.wpeo-project-wrap').on('keyup','.wpeo-add-point textarea',function(a){wpeo_point.key_up(a,jQuery(this))});jQuery('.wpeo-project-wrap').on('click','.wpeo-task-add-new-point',function(){wpeo_point.create(jQuery(this))});jQuery('.wpeo-project-wrap').on('click','.wpeo-send-point-to-trash',function(){wpeo_point.delete(jQuery(this))});jQuery('.wpeo-project-wrap').on('click','.wpeo-done-point',function(e){wpeo_point.switch_completed(e,jQuery(this))});jQuery('.wpeo-project-wrap').on('blur','.wpeo-point-input .wpeo-point-textarea',function(){wpeo_point.edit(jQuery(this))});jQuery('.wpeo-project-wrap').on('keyup','.wpeo-point-input .wpeo-point-textarea',function(){wpeo_point.preview(jQuery(this))});jQuery('.wpeo-project-wrap').on('click','.wpeo-point-input .wpeo-point-textarea',function(){wpeo_point.open_window(jQuery(this))});jQuery('.wpeo-project-wrap').on('click','.wpeo-task-point-use-toggle p',function(a){wpeo_point.toggle_completed(a,jQuery(this))});jQuery(document).on('click','#wpeo-task-form-point-time .wpeo-open-point-time-form',function(){wpeo_point.update_form(jQuery(this),true)});jQuery(document).on('click','#wpeo-task-form-point-time .wpeo-submit',function(){wpeo_point.create_point_time(jQuery(this))});jQuery(document).on('click','.wpeo-point-comment .wpeo-submit',function(){wpeo_point.edit_point_time_form(jQuery(this))});jQuery(document).on('click','.wpeo-send-point-time-to-trash',function(a){wpeo_point.delete_point_time(a,jQuery(this))});jQuery(document).on('click','.wpeo-point-time-edit-btn',function(a){wpeo_point.edit_point_time(a,jQuery(this))});jQuery(document).on('click','.wpeo-send-point-to-task',function(a){wpeo_point.send_point_to_task(a,jQuery(this))});jQuery(document).on('keypress','#wpeo-window-dashboard #wpeo-point-option input[type="text"]',function(a){wpeo_point.key_up_text_send_point(a,jQuery(this))});jQuery(document).on('click','.wpeo-project-last-comment .last-comment-page',function(a){wpeo_point.pagination(a,jQuery(this))})},key_up:function(a,b){var c=jQuery(b).closest('.wpeo-project-task');if(a.which==13){}else{if(jQuery(b).val().length==0){c.find('.wpeo-task-add-new-point').css('opacity',0.4)}else{c.find('.wpeo-task-add-new-point').css('opacity',1)}}},create:function(b){var c=jQuery(b).closest('form');var d=jQuery(b).closest('.wpeo-project-task');jQuery('.wpeo-project-wrap').off('click','.wpeo-task-add-new-point');d.bgLoad();jQuery.eoAjaxSubmit(c,{'action':'create_point'},function(){d.bgLoad('stop');jQuery('.wpeo-project-wrap').on('click','.wpeo-task-add-new-point',function(){wpeo_point.create(jQuery(this))});jQuery('.wpeo-project-wrap').on('keypress','.wpeo-add-point textarea',function(a){wpeo_point.key_up(a,jQuery(this))});jQuery(b).closest('.wpeo-project-task').find('.wpeo-task-point:first').append(this.template);d.find('.wpeo-task-li-point:last').css({'opacity':0,'left':-20}).animate({opacity:1,left:0},300);wpeo_point.refresh_flextext();wpeo_point.refresh_sortable();c.clearForm();wpeo_task.grid.masonry()})},delete:function(b){if(confirm(wpeo_project_delete_comment)){var c=jQuery(b).closest('.wpeo-task-li-point');var d=c.closest('.wpeo-project-task');var e=c.data('id');var f=c.closest('.wpeo-task-point').find('.wpeo-object-id').val();var g=c.find('.wpeo-done-point').is(':checked');c.animate({opacity:0,left:"-=20",height:0,},300,function(){jQuery(this).hide()});var h={action:'delete_point',object_id:f,point_id:e,_wpnonce:jQuery(b).data('nonce'),};jQuery.eoajax(ajaxurl,h,function(){jQuery('.wpeo-project-task-'+f+' .wpeo-project-task-time').text(this.task.option.time_info.elapsed);if(g){var a=d.find('.wpeo-task-count-completed').text();a--;d.find('.wpeo-task-count-completed').text(a)}wpeo_task.grid.masonry();jQuery('#wpeo-window-dashboard').hide()})}},edit:function(a){var b=jQuery(a).closest('.form');jQuery.eoAjaxSubmit(b,{'action':'edit_point'},function(){})},preview:function(a){jQuery('#wpeo-window-dashboard .wpeo-point-title').text(jQuery(a).val())},open_window:function(b){jQuery('#wpeo-window-dashboard *').css('opacity',0);jQuery('.wpeo-point-textarea.active').removeClass('active');jQuery(b).addClass('active');var c=jQuery(b).closest('.wpeo-project-task');var d=c.data('id');var e=jQuery(b).closest('.wpeo-task-li-point').data('id');jQuery('#wpeo-window-dashboard').css({'display':'flex','left':'-80px','opacity':0.10}).bgLoad();jQuery('#wpeo-window-dashboard').animate({'opacity':1,'left':0,},200);jQuery('.wpeo-project-task:not(.wpeo-project-task-'+d+')').hide();wpeo_task.grid.masonry();var f={action:'load_dashboard_point',task_id:d,point_id:e,_wpnonce:jQuery(b).data('nonce'),};jQuery.eoajax(ajaxurl,f,function(){jQuery('#wpeo-window-dashboard').html(this.template);jQuery('#wpeo-window-dashboard *').css('opacity',0).animate({opacity:1,},400);jQuery('#wpeo-window-dashboard').attr('data-id',e);if(!wpeo_task.all_task)jQuery(this).show();jQuery('#wpeo-window-dashboard .isDate').datepicker({dateFormat:'yy-mm-dd'});var a=parseInt(jQuery('#wpeo-window-dashboard').height()+200);jQuery('#wpeo-tasks-metabox').css('height',a)})},edit_order:function(a){var b=[];var c=jQuery(a).find('.wpeo-object-id').val();jQuery(a).find('.wpeo-task-li-point').each(function(){b.push(jQuery(this).data('id'))});var d={action:'edit_order_point',object_id:c,order_point_id:b,};jQuery.post(ajaxurl,d,function(){wpeo_task.grid.masonry()})},switch_completed:function(e,a){wpeo_point.edit(a);var b=jQuery(a).closest('.wpeo-project-task');var c=jQuery(a).closest('form');var d=b.find('.wpeo-task-count-completed').text();if(jQuery(a).is(':checked')){b.find('.wpeo-task-point-completed:first').append(c);d++}else{b.find('.wpeo-task-point:first').append(c);d--}b.find('.wpeo-task-count-completed').text(d);wpeo_task.grid.masonry();wpeo_point.refresh_sortable()},toggle_completed:function(a,b){a.preventDefault();jQuery(b).find('.wpeo-point-toggle-arrow').toggleClass('dashicons-plus dashicons-minus');jQuery(b).closest('.wpeo-task-point-use-toggle').find('ul:first').toggle(200,function(){wpeo_task.grid.masonry()})},refresh_flextext:function(){jQuery('.wpeo-project-wrap .wpeo-point-input > textarea').flexText()},refresh_sortable:function(){jQuery('.wpeo-project-wrap .wpeo-task-point-sortable').sortable({handle:'.dashicons-screenoptions',items:'.wpeo-task-point-sortable',update:function(){wpeo_point.edit_order(jQuery(this))}})},update_form:function(a,b){},create_point_time:function(b){var c=jQuery(b).closest('form').find('.wpeo-point-id').val();jQuery('#wpeo-window-dashboard').bgLoad();jQuery.eoAjaxSubmit(jQuery(b).closest('form'),{action:'create_point_time'},function(){jQuery('#wpeo-window-dashboard').bgLoad('stop');jQuery('.wpeo-point-no-comment').hide();if(this.edit){jQuery('.wpeo-point-comment-'+this.point_time_id).replaceWith(this.template)}else{jQuery('#wpeo-task-point-history').prepend(this.template)}jQuery('.wpeo-project-task-'+this.task.id+' .wpeo-project-task-time').text(this.task.option.time_info.elapsed);jQuery('.wpeo-project-task-'+this.task.id+' .wpeo-task-point-'+c+' .wpeo-time-in-point').text(this['task']['point'][c]['option']['time_info']['elapsed']);jQuery(b).closest('form').find('.wpeo-point-time-id').val(0);jQuery(b).closest('form').find('.wpeo-point-comment').val('');jQuery('#wpeo-window-dashboard .wpeo-point-elapsed-time').text(this['task']['point'][c]['option']['time_info']['elapsed']);var a=jQuery('#wpeo-window-dashboard .wpeo-point-list-point-time').text();a++;jQuery('#wpeo-window-dashboard .wpeo-point-list-point-time').text(a);wpeo_point.update_form(jQuery(this),false)})},edit_point_time_form:function(b){jQuery('#wpeo-window-dashboard').bgLoad();jQuery.eoAjaxSubmit(jQuery(b).closest('form'),{action:'create_point_time'},function(){jQuery('#wpeo-window-dashboard').bgLoad('stop');jQuery('.wpeo-point-no-comment').hide();jQuery('.wpeo-point-comment-'+this.point_time_id).replaceWith(this.template);jQuery('.wpeo-project-task-'+this.task.id+' .wpeo-project-task-time').text(this.task.option.time_info.elapsed);jQuery('.wpeo-project-task-'+this.task.id+' .wpeo-task-point-'+point_id+' .wpeo-time-in-point').text(this['task']['point'][point_id]['option']['time_info']['elapsed']);jQuery('#wpeo-window-dashboard .wpeo-point-elapsed-time').text(this['task']['point'][point_id]['option']['time_info']['elapsed']);var a=jQuery('#wpeo-window-dashboard .wpeo-point-list-point-time').text();a++;jQuery('#wpeo-window-dashboard .wpeo-point-list-point-time').text(a)})},edit_point_time:function(a,b){a.preventDefault();jQuery('#wpeo-window-dashboard').bgLoad();var c=jQuery(b).closest('.wpeo-point-comment').data('id');var d={action:'get_point_time',_wpnonce:jQuery(b).data('nonce'),point_time_id:c,};jQuery.eoajax(ajaxurl,d,function(){jQuery('#wpeo-window-dashboard').bgLoad('stop');jQuery('#wpeo-window-dashboard .wpeo-point-comment-'+this.point_time_id).replaceWith(this.template)})},delete_point_time:function(b,c){b.preventDefault();if(confirm(wpeo_project_delete_comment_time)){var d=jQuery(c).closest('#wpeo-window-dashboard').data('id');var e=jQuery(c).closest('.wpeo-point-comment').data('id');jQuery(c).closest('ul').remove();var f={action:'delete_point_time',_wpnonce:jQuery(c).data('nonce'),point_time_id:e,};jQuery.eoajax(ajaxurl,f,function(){jQuery('.wpeo-project-task-'+this.task.id+' .wpeo-task-point-'+d+' .wpeo-time-in-point').text(this['task']['point'][d]['option']['time_info']['elapsed']);jQuery('.wpeo-project-task-'+this.task.id+' .wpeo-project-task-time').text(this.task.option.time_info.elapsed);jQuery('#wpeo-window-dashboard .wpeo-point-elapsed-time').text(this['task']['point'][d]['option']['time_info']['elapsed']);var a=jQuery('#wpeo-window-dashboard .wpeo-point-list-point-time').text();a--;jQuery('#wpeo-window-dashboard .wpeo-point-list-point-time').text(a)})}},send_point_to_task:function(a,b){jQuery.eoAjaxSubmit(jQuery(b).closest('form'),{action:'send_point_to_task'},function(){jQuery('.wpeo-project-task-'+this.to_task_id+' .wpeo-task-point:first').append(this.template);jQuery('.wpeo-project-task-'+this.current_task_id+' .wpeo-task-point-'+this.point_id).remove();jQuery('.wpeo-project-task-'+this.to_task_id+' .wpeo-project-task-time').html(this.task_time);jQuery('.wpeo-project-task-'+this.current_task_id+' .wpeo-project-task-time').html(this.current_task_time);wpeo_point.refresh_flextext();wpeo_point.refresh_sortable()});return false},key_up_text_send_point:function(a,b){if(a.which==13){jQuery('#wpeo-window-dashboard #wpeo-point-option .wpeo-send-point-to-task').click();a.preventDefault();return false}},pagination:function(a,b){a.preventDefault();var c=jQuery(b).data('page');jQuery('.wpeo-project-last-comment').bgLoad();var d={'action':'load_last_comment','page':c,};jQuery.eoajax(ajaxurl,d,function(){jQuery('.wpeo-project-last-comment').replaceWith(this.template)})}};jQuery(document).ready(function(){wpeo_tag.init()});var wpeo_tag={current_task_id:0,init:function(){this.event()},event:function(){jQuery(document).on('click','.wpeo-tag-wrap:not(.wpeo-tag-wrap-edit)',function(e){wpeo_tag.load_tag(e,jQuery(this))});jQuery(document).on('click','.wpeo-tag-wrap-edit',function(e){e.stopPropagation()});jQuery(document).on('click','body',function(e){if(wpeo_tag.current_task_id!=0)wpeo_tag.edit_tag(e)});jQuery(document).on('click','.wpeo-tag-edit-tag-btn',function(e){wpeo_tag.edit_tag(e)});jQuery(document).on('click','.wpeo-tag-wrap-edit li:not(.wpeo-tag-edit-tag-btn)',function(e){wpeo_tag.select_tag(e,jQuery(this))});jQuery(document).on('click','.chosen-results .no-results',function(e){wpeo_tag.create_tag(e,jQuery(this))});jQuery('.wpeo-tag-filter').chosen({no_results_text:wpeo_project_create_tag+" : ",});jQuery('.wpeo-tag-filter').chosen().change(function(a,b){wpeo_tag.change_chosen(a,b)});jQuery('.chosen-choices').prepend('<span class="dashicons dashicons-search"></span>')},load_tag:function(e,a){var b=jQuery(a).closest('.wpeo-tag-wrap');var c=jQuery(a);var d=jQuery(a).data('id');wpeo_tag.current_task_id=d;var f=jQuery(a).data('listtagid');c.addClass('wpeo-tag-wrap-edit');b.bgLoad();var g={action:'wpeo-view-all-tag',object_id:d,list_tag_id:f,_wpnonce:jQuery(a).data('nonce'),};jQuery.eoajax(ajaxurl,g,function(){c.html(this.template);b.bgLoad('stop')});e.preventDefault();e.stopPropagation()},edit_tag:function(e){var a=jQuery('.wpeo-project-task-'+wpeo_tag.current_task_id+' .wpeo-tag-wrap');var b=wpeo_tag.current_task_id;a.bgLoad();var c={action:'view_task_tag',object_id:b,};jQuery.eoajax(ajaxurl,c,function(){a.bgLoad('stop');a.replaceWith(this.template);a.removeClass('wpeo-tag-wrap-edit');wpeo_tag.current_task_id=0})},select_tag:function(e,a){var b=jQuery(a).closest('.wpeo-tag-wrap');var c=b.data('id');jQuery(a).toggleClass('wpeo-tag-tag-selected');var d=jQuery(a).hasClass('wpeo-tag-tag-selected');var f=jQuery(a).data('slug');if(d){b.closest('.wpeo-project-task').addClass(f)}else{b.closest('.wpeo-project-task').removeClass(f)}var g={action:'edit_task_tag',object_id:c,tag_id:jQuery(a).data('id'),selected:d,_wpnonce:jQuery(a).data('nonce'),};jQuery.eoajax(ajaxurl,g,function(){if(d)jQuery('.wpeo-project-task-'+c).addClass('wpeo-'+f);else jQuery('.wpeo-project-task-'+c).removeClass('wpeo-'+f)})},create_tag:function(e,a){var b=jQuery(a).find('span').text();var c={action:'create-tag',tag_name:b,};jQuery.eoajax(ajaxurl,c,function(){jQuery('.wpeo-tag-filter').append('<option value="'+this.slug+'">'+this.name+'</option>');jQuery('.wpeo-tag-filter').trigger("chosen:updated");jQuery('.search-field input:text').focus()})},change_chosen:function(a,b){if(b.selected!=undefined){wpeo_task.filter_class_task.push('.'+b.selected)}if(b.deselected!=undefined){position=jQuery.inArray('.'+b.deselected,wpeo_task.filter_class_task);wpeo_task.filter_class_task.splice(position,1)}jQuery('.wpshop-customer-filter').val(jQuery('.wpshop-customer-filter option:first').val());var c={action:'get_summary',type:'tag',filter:wpeo_task.filter_class_task,};jQuery.eoajax(ajaxurl,c,function(){jQuery('.wpeo-project-summary-time').html(this.template)});if(wpeo_task)wpeo_task.filter_task()}};jQuery(document).ready(function(){wpeo_timeline.init()});var wpeo_timeline={init:function(){wpeo_timeline.event();wpeo_timeline.init_masonry();wpeo_timeline.add_class_blocks();wpeo_timeline.add_animation_blocks()},event:function(){jQuery(document).on('change','.wpeo-project-timeline .wpeo-header-bar select',function(a){wpeo_timeline.change_user_filter(a,jQuery(this))})},change_user_filter:function(a,b){if(jQuery(b).val()!=undefined&&jQuery(b).val()!=''){var c={action:'load_timeline_user',user_id:jQuery(b).val(),};jQuery.eoajax(ajaxurl,c,function(){jQuery('.wpeo-project-timeline .wpeo-timeline-content').replaceWith(this.template);wpeo_timeline.add_class_blocks();wpeo_timeline.add_animation_blocks()})}},init_masonry:function(){jQuery('.content-day').masonry({itemSelector:'.timeline-block.day'})},add_class_blocks:function(){var a=jQuery('.timeline-block.day');jQuery.each(a,function(){if(jQuery(this).css('left')=='0px'){jQuery(this).addClass('left-block')}else{jQuery(this).addClass('right-block')}})},add_animation_blocks:function(){var a=jQuery('.timeline-block.is-hidden');a.each(function(){if(jQuery(this).offset().top<=jQuery(window).scrollTop()+jQuery(window).height()*0.75){jQuery(this).removeClass('is-hidden')}});var a=jQuery('.timeline-block.is-hidden');jQuery(window).on('scroll',function(){a.each(function(){if(jQuery(this).offset().top<=jQuery(window).scrollTop()+jQuery(window).height()*0.75){jQuery(this).removeClass('is-hidden');if(jQuery(this).hasClass('month')){jQuery(this).addClass('bounceIn')}else if(jQuery(this).hasClass('left-block')){jQuery(this).addClass('bounceInLeft')}else{jQuery(this).addClass('bounceInRight')}}})})}};jQuery(document).ready(function(){wpeo_user.init()});var wpeo_user={list_user_open:false,list_user_owner_open:false,current_task_id:0,list_user_id:[],init:function(){wpeo_user.event()},event:function(){jQuery(document).on('click','.wpeo-main-user .wpeo-user-add:not(.wpeo-confirm-user)',function(a){wpeo_user.open_list(a,jQuery(this))});jQuery(document).on('click','.wpeo-bloc-user',function(e){e.stopPropagation()});jQuery(document).on('click','.wpeo-edit-select-user li',function(a){wpeo_user.select_user(a,jQuery(this))});jQuery(document).on('click','.wpeo-main-user .wpeo-confirm-user',function(a){wpeo_user.hide_no_active(a)});jQuery(document).on('click','body',function(a){if(wpeo_user.current_task_id!=0&&wpeo_user.list_user_open){wpeo_user.hide_no_active(a)}else if(wpeo_user.current_task_id!=0&&wpeo_user.list_user_owner_open){wpeo_user.close_list_owner(a)}});jQuery('.wpeo-user-filter').chosen().change(function(a,b){wpeo_user.change_filter(a,b)});jQuery('.wpeo-user-filter .chosen-choices').prepend('<span class="dashicons dashicons-search"></span>');jQuery(document).on('click','.wpeo-main-user .wpeo-user-owner:not(.wpeo-confirm-user)',function(a){wpeo_user.open_list_owner(a,jQuery(this))});jQuery(document).on('click','.wpeo-main-user .wpeo-user-owner.wpeo-confirm-user li',function(a){wpeo_user.select_user_owner(a,jQuery(this))})},open_list:function(a,b){var c=jQuery(b).closest('.wpeo-bloc-user');var d=c.find('.wpeo-ul-user');wpeo_user.close_list_owner(a);var e=c.data('id');wpeo_user.current_task_id=e;wpeo_user.list_user_open=true;c.bgLoad();jQuery(b).addClass('wpeo-confirm-user');jQuery(b).toggleClass('dashicons-plus dashicons-edit');d.addClass('wpeo-edit-select-user');var f={action:'wpeo-view-user',object_id:e,_wpnonce:jQuery(b).data('nonce'),};c.find('.wpeo-ul-user li').addClass('bounceOutRight');jQuery.eoajax(ajaxurl,f,function(){d.html(this.template);c.bgLoad('stop');c.find('.wpeo-ul-user li').addClass('fadeInRightBig')});a.stopPropagation();a.preventDefault()},select_user:function(a,b){var c=jQuery(b).closest('.wpeo-bloc-user');var d=c.data('id');var e=jQuery(b).data('id');jQuery(b).toggleClass('active');var f={action:'wpeo-update-user',object_id:d,user_id:e,selected:jQuery(b).hasClass('active'),_wpnonce:jQuery(b).data('nonce'),};jQuery.eoajax(ajaxurl,f,function(){if(this.affected_to_task){c.closest('.wpeo-project-task').addClass('wpeo-affected-task')}else{c.closest('.wpeo-project-task').removeClass('wpeo-affected-task')}})},hide_no_active:function(a){if(wpeo_user.list_user_open){a.preventDefault();var b=jQuery('.wpeo-project-task-'+wpeo_user.current_task_id+' .wpeo-bloc-user');b.find('.wpeo-ul-user li').removeClass('fadeInRightBig').addClass('bounceOutRight');setTimeout(function(){b.find('.wpeo-ul-user li:not(.active)').remove();b.find('.wpeo-ul-user li').removeClass('bounceOutRight').addClass('fadeInRightBig')},500,function(){b.find('.wpeo-ul-user li').removeClass('fadeInRightBig')});b.find('.wpeo-confirm-user').removeClass('wpeo-confirm-user');b.find('.wpeo-edit-select-user').removeClass('wpeo-edit-select-user');b.find('.dashicons-edit').toggleClass('dashicons-plus dashicons-edit');wpeo_user.current_task_id=0;wpeo_user.list_user_open=false}},open_list_owner:function(a,b){var c=jQuery(b).closest('.wpeo-bloc-user');var d=c.data('id');wpeo_user.hide_no_active(a);wpeo_user.current_task_id=d;c.find('.wpeo-user-owner').addClass('wpeo-confirm-user');var e={action:'wpeo-render-edit-owner-user',_wpnonce:jQuery(b).data('nonce'),task_id:d,owner_id:jQuery(b).find('li').data('id'),};jQuery.eoajax(ajaxurl,e,function(){wpeo_user.list_user_owner_open=true;c.find('.wpeo-user-owner').append(this.template)})},select_user_owner:function(a,b){var c=jQuery(b).closest('.wpeo-bloc-user');var d=c.data('id');var e={action:'wpeo-edit-task-owner-user',_wpnonce:jQuery(b).data('nonce'),task_id:d,owner_id:jQuery(b).data('id'),};jQuery.eoajax(ajaxurl,e,function(){c.find('.wpeo-user-owner').html(c.find('.wpeo-user-owner li.wpeo-user-'+this.owner_id));c.find('.wpeo-user-owner').removeClass('wpeo-confirm-user');wpeo_user.current_task_id=0;wpeo_user.list_user_owner_open=false})},close_list_owner:function(a){if(wpeo_user.list_user_owner_open){var b=jQuery('.wpeo-project-task-'+wpeo_user.current_task_id+' .wpeo-bloc-user');b.find('.wpeo-user-owner').html(b.find('.wpeo-user-owner li:first'));b.find('.wpeo-user-owner').removeClass('wpeo-confirm-user');wpeo_user.current_task_id=0;wpeo_user.list_user_owner_open=false}},change_filter:function(a,b){if(b.selected!=undefined){wpeo_task.filter_class_task.push('.'+b.selected);wpeo_user.list_user_id.push(jQuery('.wpeo-user-filter option[value="'+b.selected+'"]').data('id'))}if(b.deselected!=undefined){position=jQuery.inArray('.'+b.deselected,wpeo_task.filter_class_task);wpeo_task.filter_class_task.splice(position,1);position=jQuery.inArray(b.deselected,wpeo_user.list_user_id);wpeo_user.list_user_id.splice(position,1)}var c={action:'get_summary',type:'user',list_user_id:wpeo_user.list_user_id,};jQuery.eoajax(ajaxurl,c,function(){jQuery('.wpeo-project-summary-time').html(this.template)});if(wpeo_task){wpeo_task.filter_task()}}};jQuery(document).ready(function(){jQuery.eoajax=function(b,c,d){if(typeof d=='function'){jQuery.post(b,c,function(a){if(a&&!a.success){}else{d.call(a.data)}})}};if(jQuery.fn.ajaxSubmit){jQuery.eoAjaxSubmit=function(b,c,d){if(typeof d=='function'){b.ajaxSubmit({'data':c,'success':function(a){if(a&&!a.success){}else{d.call(a.data)}}})}return this}};if(jQuery.fn.ajaxForm){jQuery.eoAjaxForm=function(d,e,f){if(typeof f=='function'){d.ajaxForm({'data':e,'beforeSubmit':function(a,b,c){return false},'success':function(a){if(a&&!a.success){}else{f.call(a.data)}}})}return this}}});